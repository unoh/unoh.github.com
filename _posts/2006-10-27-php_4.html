---
layout: post
title: "PHPのちょっとしたコツ"
---
{% raw %}
Keitaです。<br />
<br />
<blockquote><br />
個人的には、Pythonの思想を取り入れた JavaScript 1.7 がとても気になっているのですが、それは明日の Keita（個々一番さん）が説明してくれると思うので楽しみに待つことにしましょう☆<br />
</blockquote><br />
ウノウの社員は、<a href="http://0xcc.net/blog/archives/000133.html">スルー力</a>も必要なようです。<br />
<br />
さて、そんな世迷言はみなかったことにして、PHPの話題です。<br />
PHPいいよ、PHP素敵だよ。<br />
<br />
さて、今回は日ごろ気をつけているPHPのコーディングのコツをTIPS形式で書いていこうと思います。<br />
<br />
しかし、はるか過去にいろいろな所で情報収集したので情報の出典を忘れてしまいました。<br />
わかる限りはURLを記載していきますが、記載されてない所があったらすいません＆コメントで補足いただけると助かります。<br />
<br />
<b>1.  array_pushは遅い</b><br />
いくつかのBlogで語られてることですが、array_pushは、次のような書き方のほうが早いそうです。<br />
<br />
<pre class="source_code"><br />
	//array_puth($array, 'arraydata');<br />
	$array[] = 'arraydata';<br />
</pre><br />
<br />
PHPをいじってきた感想でいうと、全体的に組み込み系の関数の類を使うよりは、PHPの構文として定義されているものを利用するほうが早いことが多いです。<br />
<br />
<b>2. array_key_existsよりハッシュを使え</b><br />
array_searchは、毎回全データを検索するので遅いです。<br />
データに配列の順序が関係ないなら、連想配列 + issetを使うほうが高速です。<br />
連想配列の場合ハッシュの仕組みが使われるのでその分高速です。<br />
同様に、array_key_existsよりissetのほうがはるかに高速です。<br />
<pre class="source_code"><br />
    //$array[] = 'arraydata';<br />
    //if (array_search('arraydata', $array)) {<br />
    //    echo 'あるよ。';<br />
    //}<br />
<br />
    $array['arraydata'] = 'arraydata';<br />
    if (isset($array['arraydata'])}<br />
        echo 'あるよ。';<br />
    }<br />
</pre><br />
<br />
<br />
上の２つの、array関係は、多数の値がある場合に結構変わってきます。<br />
<br />
<a href="http://labs.unoh.net/2007/01/array_key_check.html"><span style="color: #FF0000;">※情報が不正確でしたこちらの記事を参照ください</span></a><br />
<br />
<br />
<b>3. $_ほげほげは直接使わない</b><br />
これは心得の問題です。<br />
$_GETや、$_POSTなどの値は直接使わないようにしましょう。<br />
特に$_SERVERには、外部から送られてくる値を直接格納している場合がありますのでこれを直接使うとひどい目にあいます。<br />
一般的なフレームワークなら、これらをラッピングする関数などが準備されているハズですのでこれを使いましょう。<br />
<br />
<b>4. if文は「===」を使う</b><br />
PHP勉強会で、Dinoの<a href="http://pukiwiki.hnw.jp/index.php?PHP%CA%D9%B6%AF%B2%F1%2F%A4%B5%A4%DE%A4%B6%A4%DE%A4%CA%C3%CD%A4%CE%C8%E6%B3%D3%C9%BD">hnwさんに教わった</a>ことですが、'0.00' == '0'は真です。<br />
もし、仮に、パスワード処理でデータ側でMD5などのハッシュ化してない場合に、上記が真になっては非常にまずいのではないでしょうか。<br />
さらにいえば、もっといろいろな形で、真となる場合があるので「==」は使わず、「===」を使いましょう。<br />
<br />
<pre class="source_code"><br />
    if ($str === 'hoge') {<br />
    if (! ($str === 'hoge')) {<br />
    if (is_null($null) === false) {<br />
</pre><br />
<s><br />
<b>5. <strice>countは配列数を毎回数えてる</b><br />
これを知ったのは、<a href="http://pukiwiki.sourceforge.jp/dev/?cmd=read&page=BugTrack%2F779">Pukiwkiのクリーンアップ</a>の記事を見たときなのですが。<br />
countは配列の件数を数えるらしいので次のような書き方に直したほうが無難です。<br />
<br />
<pre class="source_code"><br />
    // if(count($array))<br />
   if(! empty($array))<br />
   // for($i = 0; $i < count($array); $i++)<br />
   $count = count($array);<br />
   for($i = 0; $i  < $count; $i++)<br />
</pre><br />
</s><br />
※毎回数えてるわけではないらしい。<br />
お詫びして訂正します。<br />
<br />
まぁ、基本的に、ZendFrameworkや、Pearのコーディング規約でことたりるような気もします。
{% endraw %}
