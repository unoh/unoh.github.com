---
layout: post
permalink: /2007/10/05/erwww_sql_designer.html
title: "ブラウザでER図が描ける「WWW SQL Designer」紹介"
date: 2007-10-05T21:15:11.00+09:00
tags:
  - "miyake"
categories:
  - "レポート"
---
<p>miyakeです。皆さんドキュメントはしっかり書いていますか？　近頃のWeb界隈では、詳細仕様書的なものは作らずにスピーディーに開発を進めるケースも多いかも知れません。ドキュメント作成のコストは小さくありませんし、内容を最新に保つのも一苦労です。とは言え、複数の人間が関わるプロジェクトにはER図はあると嬉しいなと個人的には思います。</p>
<p>今日はそんなER図をブラウザ上で作成するアプリケーション「<a href="http://ondras.zarovi.cz/sql/">WWW SQL Designer</a>」をご紹介します。</p>

<p>以下のスクリーンショットは、このアプリを実際に触って試せる<a href="http://ondras.zarovi.cz/sql/demo/">live DEMO</a>のものです。</p>
<p><a href="http://photozou.jp/photo/show/784/5305375"><img src="http://art8.photozou.jp/pub/784/784/photo/5305375.png" alt="WWW SQL Designer" width="450" height="248" style="border:0" /></a><br /><a href="http://photozou.jp/photo/show/784/5305375">WWW SQL Designer</a> posted by <a href="http://photozou.jp/mypage/top/784">(C)フォト蔵</a></p>
<p>上部のメニューからテーブルやカラムを作ったり消したりして、テーブルをドラッグアンドドロップで配置、リレーションを同じくドラッグアンドドロップで設定、というのがおおまかな作業の流れになります。まずは実際にデモを触ってみるのが一番分かりやすいかと思います。</p>

<h3>■動作環境</h3>
<p>live DEMO上でも作業は可能ですが、実際に使う場合はダウンロードして自分のサーバ上で動作させるのが一般的でしょう。</p>
<p>WWW SQL Designerはphpで書かれているので、phpが動く環境が必要です。php5でしか試していないのですが、恐らく4でも動くのではないかと思います。</p>
<p>また、データベース内にER図の情報を保存する場合はMySQLが必要となります。</p>

<h3>■インストール＆初期設定</h3>
<p>配布されているzipファイルをダウンロードして、しかるべき場所に展開すればとりあえず動きます。</p>
<p>ER図のデータをDBに保存する場合は、io.phpの初めの方にある</p>
<pre class="code"><code>/* mysql: */
    define('SERVER','localhost');
    define('USER','');
    define('PASSWORD','');
    define('DB','');
    define('TABLE','wwwsqldesigner');
    $conn = mysql_connect(SERVER,USER,PASSWORD);
    mysql_select_db(DB);
/**/</code></pre>
<p>という部分のUSER, PASSWORD, DBにそれぞれユーザ名、パスワード、DB名を書き込みます。</p>
<p>また、僕は試していないのですが、ODBC経由でDBの情報をインポートする機能があるようで、その設定はimport.phpの初めの方に、</p>
<pre class="code"><pre>$conn = odbc_connect('','','');</pre></pre>
<p>として用意されています。</p>

<h3>■基本的な操作</h3>
<p>直感的な操作が出来るようになっているのですが、最初は分かりづらいかも知れないので（特にリレーションの設定）まとめておきます。</p>
<dl>
 <dt>テーブル作成</dt>
 <dd>New tableをクリックした後で、作業スペースをクリックするとその場所にテーブルが出来る</dd>
 <dt>テーブル削除</dt>
 <dd>テーブルをクリックで選択して、Delete tableをクリック</dd>
 <dt>カラムの作成</dt>
 <dd>テーブルを選択して、Add rowをクリック</dd>
 <dt>カラムの削除</dt>
 <dd>カラムを選択して、Delete rowをクリック</dd>
 <dt>カラムの位置変更</dt>
 <dd>カラムを選択して、Up, Downをクリック</dd>
 <dt>リレーションの設定</dt>
 <dd>PrimaryKeyに設定したカラムを選択して、そのままドラッグして結合対象のテーブル上でボタンを放す</dd>
</dl>

<h3>■データの書き出しと読み込み</h3>
<p>WWW SQL Designerは、ER図のデータをXMLとして扱います。XMLでデータを管理する場合は、IMPORT/EXPORTメニューから Export XML あるいは Import XML を選択して GO! をクリックします。するとサブウィンドウが表示されるので、書き出しの場合はコピーして保存、読み込みの場合は貼り付けてLoadをクリックします。</p>
<p>DBに保存する場合は、Save to database, Save As... to database, Load from databaseでそれぞれ操作します。途中でKeywordの入力を求められますが、これがそのER図の名前になります。</p>
<p>DBから読み込む場合はURLパラメータのkeywordで指定してやると、ブラウザで開いた時にそのデータが読み込まれます。</p>
<p>DBに保存した場合も、XMLをそのまま格納しているだけなので、どちらを使ってもいいでしょう。</p>
<p>csvの読み書きには対応していないので、必要であればメニューを改造して実装するか、XMLと相互変換するスクリプトを組むことになります。</p>

<h3>■使い方の例</h3>
<p>あくまで個人的な使い方ですが、参考までにご紹介します。</p>
<p>まず、ER図はプロジェクトの初期段階で描き起こします。データは日付毎に保存したり、確認・修正が容易なのでXMLファイルで運用します。</p>
<p>既存のプロジェクトで利用する場合は、XMLにテーブルとカラムの一覧を書き起こして、それをImport from XMLで読み込ませました。場合によっては、ちゃんと設定した上でODBC経由でimportした方が便利かも知れません（やってないので何とも言えません）。</p>
<p>WWW SQL Designerでは各カラムの型や文字数も設定可能ですが、操作が面倒なのと、ブラウザ上ではそのカラムを選択しないと内容が見えないので、そこはあえて無視することにしました。ただ、数値型・文字型・日付型・その他でカラムの色が変わるので、そこは選択しておきます。</p>
<p>ある程度まとまった時点でGenerate MySQL scriptでSQLとして書き出します。各カラムの設定をちゃんとしていないので、後はテキストエディタで適宜設定やコメントを書いていきます。</p>
<p>開発を進めていく上でDBを変更する場合は、ER図とSQLの二重メンテが発生しますが、そこは割り切って両方手を入れます。ER図の側でカラム設定を手抜きするので、それほど手間ではありません。</p>
<p>残念ながらER図を画像として出力する機能はありませんので、最終的なER図はスクリーンショットから作ることにします。</p>
<p>IMPORT/EXPORTメニューからOpen print viewを実行すると、上部のメニューと右下の全体図が消えます。この状態でスクリーンショットを取ります。消えたメニューを元に戻す方法は無さそうなので、ブラウザで再読込するしかないようです。データの保存は前もって！</p>
<p>図が1画面に収まらないケースがほとんどだと思いますが、そこはFirefoxのアドオンなどでクリアします。ちなみに、僕は<a href="https://addons.mozilla.org/ja/firefox/addon/1146">Screengrab!</a>を使っています。</p>
<p>そのままだと大きすぎるので、Fireworksでリサイズして、必要ならば注釈などを加えた上で画像として保存します。これでER図の完成です。ここの処理はいくらでもやりようがあるので、お好きな方法でどうぞ。</p>

<h3>■リレーションの制限を解除する</h3>
<p>2007年10月5日現在の最新版であるVersion 1.3.4では、外部キーとして設定出来るのはPrimaryKeyに指定したカラムだけとなっているようです。</p>
<p>「テーブルには全てintでauto_incrementなidをPKとして設定し、結合はそのidで行う」というルールでDBを設計している場合はあまり困ることはないと思いますが、この制限を解除したい場合はJavaScriptを書き換えることで対応出来ます。</p>
<p>現在、PrimaryKeyに指定していないカラムではドラッグ系のイベントが働かないようになっているらしく、その判定をしないようにしてやればOKです。</p>
<p>具体的には、js/main.jsの153～155行目、</p>
<pre class="code"><code>
if (table_array[number].rows[rownumber].pk) {
    drag_start = src;
}</code></pre>
<p>となっている部分のifを外して、</p>
<pre class="code"><code>drag_start = src;</code></pre>
<p>だけにします。ただし、この状態だと同じテーブル内で間違えて、少しでもドラッグアンドドロップをしてしまうと、同一テーブル内での参照が作れてしまうので少し注意が必要です。</p>

<h3>■まとめ</h3>
<p>あまり複雑なER図には対応出来なかったり、Webアプリであるが故の制約もありますが、これだけのソフトがフリーで公開されているというのは嬉しいことです。</p>
<p>また、WWW SQL Designerは現在も積極的に開発が進められており、今後の機能増強も期待出来ます。</p>
<p>個人的には非常にありがたく使わせてもらっていますので、ER図を描くツールに困っている方は一度試してみてはいかがでしょうか？</p>

