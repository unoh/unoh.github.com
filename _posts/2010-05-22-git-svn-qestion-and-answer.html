---
layout: post
title: "git-svn駆け込み寺"
---
こんにちは。murahashiです。<br />
gitやgit-svnを使うにあたり、試したことや引っかかったことについて、yukiのエントリ <a href="http://labs.unoh.net/2010/04/subversiongitgit-svn.html">ウノウラボ Unoh Labs: subversionリポジトリでもgitが使えるgit-svn</a> のつづきを書いてみました。<br />
<br />
<span class="mt-enclosure mt-enclosure-image" style="display: inline;"><img alt="git_svn_bad_200x280.jpg" src="http://labs.unoh.net/git_svn_bad_200x280.jpg" width="200" height="280" class="mt-image-left" style="float: left; margin: 0 20px 20px 0;" /></span>Q. ブランチ名を長くしてしまったので手打ちするのが大変です<br />
<br style="clear:left" /><br />
<br />
<span class="mt-enclosure mt-enclosure-image" style="display: inline;"><img alt="git_svn_good_200x289.jpg" src="http://labs.unoh.net/git_svn_good_200x289.jpg" width="200" height="289" class="mt-image-left" style="float: left; margin: 0 20px 20px 0;" /></span>A. bashでgitコマンドを補完します<br />
<br />
gitのコマンド補完は git-completion.bash が便利です。<br />
fedoraにyumでgitを入れた場合には下記場所にあります。<br />
<pre class="code">/usr/share/doc/git-VERSION/cntrib/completion/</pre><br />
<br />
自分の見える場所にgit-completion.bashがなければ、インストール済みのgitと同じversionのgitのソースをダウンロードします。<br />
<pre class="code">cntrib/completion/</pre><br />
に入っているので.bashrcのなかで読み込みましょう。補完が効くようになります。<br />
<br style="clear:left" /><br />
<hr /><br />
<span class="mt-enclosure mt-enclosure-image" style="display: inline;"><img alt="git_svn_bad_50x70.jpg" src="http://labs.unoh.net/git_svn_bad_50x70.jpg" width="50" height="70" class="mt-image-left" style="float: left; margin: 0 20px 20px 0;" /></span>Q. 除外設定にしていたファイルがコミットされてしまいます<br />
<br style="clear:left" /><br />
<br />
<span class="mt-enclosure mt-enclosure-image" style="display: inline;"><img alt="git_svn_good_50x72.jpg" src="http://labs.unoh.net/git_svn_good_50x72.jpg" width="50" height="72" class="mt-image-left" style="float: left; margin: 0 20px 20px 0;" /></span>A. .git/info/exclude に書きましょう<br />
<pre class="code">$ git svn show-ignore >> .git/info/exclude</pre><br />
<br />
svn:ignoreと.gitignoreで混乱しないようにしましょう。<br />
<br style="clear:left" /><br />
<hr /><br />
<br />
<span class="mt-enclosure mt-enclosure-image" style="display: inline;"><img alt="git_svn_bad_50x70.jpg" src="http://labs.unoh.net/git_svn_bad_50x70.jpg" width="50" height="70" class="mt-image-left" style="float: left; margin: 0 20px 20px 0;" /></span>Q. 中身が空のディレクトリが作られません<br />
<br style="clear:left" /><br />
<br />
<span class="mt-enclosure mt-enclosure-image" style="display: inline;"><img alt="git_svn_good_50x72.jpg" src="http://labs.unoh.net/git_svn_good_50x72.jpg" width="50" height="72" class="mt-image-left" style="float: left; margin: 0 20px 20px 0;" /></span>A. 自分で作りましょう<br />
<br />
gitだけを使ったプロジェクトで空ディレクトリ作りたいときは空の.gitignore ファイルをいれておくのが定番です。<br />
git-svn利用時に.gitignoreをコミットしていいかについては話し合いましょう。<br />
<br style="clear:left" /><br />
<hr /><br />
<br />
<span class="mt-enclosure mt-enclosure-image" style="display: inline;"><img alt="git_svn_bad_50x70.jpg" src="http://labs.unoh.net/git_svn_bad_50x70.jpg" width="50" height="70" class="mt-image-left" style="float: left; margin: 0 20px 20px 0;" /></span>Q. svn externals を自動で取得してくれません<br />
<br style="clear:left" /><br />
<br />
<span class="mt-enclosure mt-enclosure-image" style="display: inline;"><img alt="git_svn_good_50x72.jpg" src="http://labs.unoh.net/git_svn_good_50x72.jpg" width="50" height="72" class="mt-image-left" style="float: left; margin: 0 20px 20px 0;" /></span>A. git-svn-clone-externals を使いましょう<br />
<br />
<a href="http://stackoverflow.com/questions/350651/how-do-i-keep-an-svnexternal-up-to-date-using-git-svn">How do I keep an svn:external up to date using git-svn? - Stack Overflow</a><br />
<a href="http://github.com/andrep/git-svn-clone-externals">andrep's git-svn-clone-externals at master - GitHub</a><br />
ほかにもいろいろ手段はあって、一長一短の解説が書いてあるページもありました(url失念)。私はシンプルなのがいいと、git-svn-clone-externalsを利用しています。事前に別の場所で試してみるとよいでしょう。<br />
<br style="clear:left" /><br />
<hr /><br />
<br />
<span class="mt-enclosure mt-enclosure-image" style="display: inline;"><img alt="git_svn_bad_50x70.jpg" src="http://labs.unoh.net/git_svn_bad_50x70.jpg" width="50" height="70" class="mt-image-left" style="float: left; margin: 0 20px 20px 0;" /></span>Q. git-svn-clone-externals 動かないのですが<br />
<br style="clear:left" /><br />
<br />
<span class="mt-enclosure mt-enclosure-image" style="display: inline;"><img alt="git_svn_good_50x72.jpg" src="http://labs.unoh.net/git_svn_good_50x72.jpg" width="50" height="72" class="mt-image-left" style="float: left; margin: 0 20px 20px 0;" /></span>A. show-externals、みえていますか<br />
<br />
<pre class="code">$ git svn show-externals</pre><br />
<br />
これが見えていないとfetchできません。<br />
私の場合、見えていたリポジトリと見えてないリポジトリがありました。<br />
リポジトリ間の設定を目diffして見えていない側に追加したところ、見えていなかった側からshow-externalsが見えるようになりました。<br />
ここはちょっとよくわからないです。svn側がtrunk決め打ちの人しか下記追加は当てはまらないと思います。<br />
<pre class="code">$ git config --add svn-remote.svn.url svn+ssh://example.com/path/to/repository/trunk
$ git config --add svn-remote.svn.fetch :refs/remotes/git-svn</pre><br />
<br />
同じプロジェクトで同じ開発マシンを使っているのにshow-externalsが見えない人もいました。原因を探す余裕がない場合は別の手段をとるしかないでしょう。git submodule使うとか、git cloneして放り込んでignoreとか、動く手段を探してください。<br />
<br style="clear:left" /><br />
<hr /><br />
<br />
<span class="mt-enclosure mt-enclosure-image" style="display: inline;"><img alt="git_svn_bad_50x70.jpg" src="http://labs.unoh.net/git_svn_bad_50x70.jpg" width="50" height="70" class="mt-image-left" style="float: left; margin: 0 20px 20px 0;" /></span>Q. svnリポジトリにコミットしたいです<br />
<br style="clear:left" /><br />
<br />
<span class="mt-enclosure mt-enclosure-image" style="display: inline;"><img alt="git_svn_good_50x72.jpg" src="http://labs.unoh.net/git_svn_good_50x72.jpg" width="50" height="72" class="mt-image-left" style="float: left; margin: 0 20px 20px 0;" /></span>A. mergeしてdcommitするのが堅いです<br />
<br />
ローカルのgitリポジトリにコミットしたあと、<br />
<br />
<pre class="code">$ git branch //今のブランチを確認
 * 000_TOPIC_BRANCH
   master
$ git diff //差分ないことを確認
$ git checkout master
$ git branch //今のブランチを確認
   000_TOPIC_BRANCH
 * master
$ git svn rebase //svn update相当
$ git merge --no-ff --no-commit 000_TOPIC_BRANCH
$ git add .
$ git commit -v
$ git svn dcommit</pre><br />
<br />
できました！<br />
no-ffなのはよくわかっていなくておまじない状態です。<br />
no-commitは自分でdiffとつき合わせてコミットログを書きたいからです。<br />
ローカルのgit側では頻繁にcommitかつ適当にコメントを書いているので、リモートのsvn側にpushする際にきちんとコミットコメントをかくように調整しています。<br />
ただこの運用でsvn側のコミット粒度が荒くなってしまったので、注意がいるかもしれません。<br />
<br style="clear:left" /><br />
<hr /><br />
<br />
<span class="mt-enclosure mt-enclosure-image" style="display: inline;"><img alt="git_svn_bad_50x70.jpg" src="http://labs.unoh.net/git_svn_bad_50x70.jpg" width="50" height="70" class="mt-image-left" style="float: left; margin: 0 20px 20px 0;" /></span>Q. svnのあれがgitで<br />
<br style="clear:left" /><br />
<br />
<span class="mt-enclosure mt-enclosure-image" style="display: inline;"><img alt="git_svn_good_50x72.jpg" src="http://labs.unoh.net/git_svn_good_50x72.jpg" width="50" height="72" class="mt-image-left" style="float: left; margin: 0 20px 20px 0;" /></span>A. あるていどは割り切りましょう<br />
<br />
結局のところ何でもかんでもすべてをgitやgit-svnでやろうとするのは無理があるので、こみいったところはsvnコマンドたたくほうがよいと思います。ほかにもtortoiseSVNとtortoiseGitの違いとかwindowsでgitとかいろいろあると思います。<br />
<br style="clear:left" /><br />
<hr /><br />
<br />
濱野さんの入門Gitの「chapter16 間違いからの回復」を繰り返し参照することになるので手元にあると便利ですね。<br />
<br />
以上デース<br />
<br style="clear:left" /><br />
<br />
<div style="margin:0;padding:.5em;border:2px solid #ccc">ウノウでは特に最近、積極的にエンジニアを採用しています。<br /><br />
<a href="http://www.unoh.net/recruit.html">採用ページ</a>をご覧になり興味のある方、ぜひご応募ください。<br/><br />
<a href="http://www.find-job.net/fj/showjob.cgi?id=50212">Find Job!</a>でも募集してます！</div>
