---
layout: post
title: "Flashの新しい可能生 Asynchronous Flash + XMLSocket"
---
{% raw %}
<p>
尾藤正人(a.k.a BTO)です
</p>

<p>
昨日ラボプロジェクトとして実験的に開発している新規プロジェクト「<a href="http://plash.jp/">プラッシュ</a>」をβ公開しました。
簡単に説明するとプラッシュはFlashとXMLSocketを使う事でブラウザだけでネットワーク対戦ができるゲームポータルサイトです。
今回はプラッシュで使われているFlashとXMLSocketを使ったアプローチについて考察してみたいと思います。
</p>

<h3>はじめに</h3>

<p>
正直に告白すると僕はFlashを一行も書いた事がありません。(汗)
なので、Flashの部分に関してはFlash側の開発者である<a href="http://www.be-interactive.org/">yossy</a>に聞いたり、Webで調べた情報がほとんどです。
不正確な情報が含まれてる可能性がありますが、その辺を考慮していただければと思います。
</p>

<h3>FlashのXMLSocketで何ができるのか</h3>

<p>
FlashのXMLSocketを使うと直接ソケット通信を行う事ができます。
AjaxやCometのような技術は元々ステートレスなHTTP上で非同期通信を実現していますが、
XMLSocketは直接ソケットを叩けるので自然な非同期通信を行う事ができます。
AjaxやCometはデータのやり取りをする度にコネクションが切れますが、XMLSocketはずっとコネクションをはったまま通信を行います。
</p>

<p>
通信の度にコネクションを確立するアプローチだと、毎回接続するためのコストがかかります。
XMLSocketはずっとコネクションをはっているので、通信の度に接続する必要がなく、よりリアルタイムな通信を実現する事ができます。
プラッシュではそれをネットワーク対戦ゲームに応用しました。
</p>

<h3>Flashを使ったリアルタイム通信で何ができるのか</h3>

<p>
それは僕にもわかりませんが、大いなる可能生は感じています。
Flashを使う最大のメリットはブラウザだけで動作する事です。
それにリアルタイム通信が加わった時に、従来ブラウザだけではできなかったことがブラウザだけでできるようになり、新たなる市場が開拓されるかもしれません。
</p>

<h3>何が必要なのか</h3>

<p>
FlashでXMLSocketを使用した通信を行うには次のものが必要です。<br />
・Flash Player 5以降<br />
・XMLSocketサーバ<br />
・プロトコル
</p>

<h4>Flash Player 5以降</h4>

<p>
Flash Player 5以降でないとXMLSocketは使えないそうです。
</p>

<h4>XMLSocketサーバ</h4>

<p>
XMLSocketは直接ソケットを叩くので、独立したサーバが必要になります。
プラッシュではオリジナルのXMLSocketサーバを開発しました。
</p>

<h4>プロトコル</h4>

<p>
XMLSocketでの通信はソケットを直接叩くので具体的なデータのやり取りについては定められていません。
汎用的なプロトコルは存在しないので、クライアント側、サーバ側であらかじめ決められたプロトコルを定めて通信を行う事になります。
プラッシュではXMLをベースにした独自プロトコルで通信を行っています。
</p>

<h3>Flash+XMLSocketを使った既存の実装は</h3>

<p>
Flash+XMLSocketを使ったチャットの実装はいくつか公開されているようです。
それ以上本格的なものはなかなか見つからないのが現状です。
</p>

<p>
<a href="http://tenhou.net/">天鳳</a>というオンライン麻雀がありますが、これはFlash+XMLSocketで作られています。
天鳳は大変素晴らしい実装なので一度遊んでみるといいと思います。
</p>

<h3>Flash+XMLSocketをもっと普及させるには</h3>

<p>
Flash+XMLSocketを使ったリアルタイム通信は古くから存在するにも関わらず、それほど注目されていませんでした。
僕はこの技術に大いなる可能生を感じていて、もっと広く普及しないかなと思っています。
そこでこの技術が普及するために何が必要かを考えてみました。
</p>

<h4>名前をつける</h4>

<p>
技術がより一般的になるためには呼びやすい名前が必要です。
「FlashとXMLSocketを使ってリアルタイム通信するやつ」なんてのはかったるくて呼びづらい。
何か良い名前はないでしょうか。
</p>

<h4>開発の敷居を下げる</h4>

<p>
より多くの実装が出てくるには開発の敷居を下げる事が重要。
開発の敷居を下げるために必要なことをつらつらと書いてみます。
</p>

<h4>フリーの汎用的なXMLSocketサーバ</h4>

<p>
既にXMLSocketサーバの実装はいくつかあるようですが、開発が止まっていたり、チャットに特化しているのが実情のようです。
フリーで汎用的なXMLSocketサーバがあれば開発の敷居を大きく下げる事ができると思っています。
</p>

<p>
モジュールのような形でプログラムを書く事ができて、LLで実装できるようなやつ。
プラッシュではRubyでXMLSocketサーバを書いてます。
LLでもうまくやれば十分サーバの開発は可能です。
</p>

<h4>汎用的なプロトコル</h4>

<p>
実装するたびに毎回独自プロトコルを作るのは大変ですから、汎用的なプロトコルが欲しいところ。
汎用的で可読性が高くて単純で拡張性が高いプロトコルがいいかなと思っています。
汎用的なプロトコルを定義するだけでなく、もちろんそれをベースにしたFlashライブラリ、XMLSocketサーバの実装も必要です。
</p>

<h3>まとめ</h3>

<p>
みなさんもFlash+XMLSocketを使って何か実装してみてはどうでしょうか。
今までにない何かが作れるかもしれません。
</p>

<p>
今回プラッシュで作った成果物は何らかの形でうまく公開できないか思案中です。
公開する時には、またこのブログで紹介したいと思います。
</p>
{% endraw %}
